{#- name: "worker_sbatch_script" -#}

{% if is_batch_worker %}
. '{{ worker_script_path }}'
{% else %}
srun /bin/bash '{{ worker_script_path }}'
{% endif %}

{#- name: "worker_script" -#}

#!/bin/bash

. '/etc/profile'
. '{{ setup_script }}'

set -Eeuo pipefail
set -x

slurm-pilot-worker \
    --group '{{ group }}' \
    --name '{{ name }}' \
    --server-address '{{ server_address }}' \
    --work-dir '{{ work_dir }}' \
    --python-paths-json '{{ python_paths_json }}'
